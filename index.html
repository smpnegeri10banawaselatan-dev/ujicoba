<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hasil Absen Kehadiran Siswa</title>
  
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold mb-4 text-blue-700">Hasil Absen Kehadiran Siswa</h1>

    <!-- Toolbar -->
    <div class="flex gap-2 mb-4">
      <input id="search" type="search" placeholder="Cari..." 
        class="flex-1 px-3 py-2 border rounded shadow-sm focus:ring focus:ring-blue-300" />
      <button id="reload" class="px-4 py-2 bg-blue-600 text-white rounded shadow">Reload</button>
      <button id="csv" class="px-4 py-2 bg-green-600 text-white rounded shadow">Download CSV</button>
    </div>

    <!-- Table -->
    <div id="tableWrap" class="overflow-x-auto bg-white shadow rounded-lg">
      <table id="sheetTable" class="min-w-full text-sm border-collapse"></table>
    </div>

    <!-- Pagination -->
    <nav class="mt-4">
      <ul id="pagination" class="pagination justify-content-center"></ul>
    </nav>
  </div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vToe0xNuzA78YNxdhI7-JGaA1oPBuRH9JlQgzwoaE8C0U5kG4FNOajyzKyddqkKAWE0hDKX9vrq-QhB/pub?gid=1735243266&single=true&output=csv";

let currentHeaders = [], currentData = [];
let currentPage = 1;
const rowsPerPage = 10;

function renderTable(headers, data) {
  const table = document.getElementById('sheetTable');
  table.innerHTML = '';

  // Header
  const thead = document.createElement('thead');
  thead.className = 'bg-blue-100';
  const trh = document.createElement('tr');
  headers.forEach(h => {
    const th = document.createElement('th');
    th.textContent = h;
    th.className = 'px-4 py-2 text-left font-semibold';
    trh.appendChild(th);
  });
  thead.appendChild(trh);
  table.appendChild(thead);

  // Body (pagination slice)
  const tbody = document.createElement('tbody');
  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const pageData = data.slice(start, end);

  pageData.forEach((row, i) => {
    const tr = document.createElement('tr');
    tr.className = i % 2 === 0 ? 'bg-white' : 'bg-gray-50';
    row.forEach(cell => {
      const td = document.createElement('td');
      td.textContent = cell;
      td.className = 'px-4 py-2 border-t';
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);

  renderPagination(data.length);
}

function renderPagination(totalRows) {
  const pageCount = Math.ceil(totalRows / rowsPerPage);
  const pagination = document.getElementById('pagination');
  pagination.innerHTML = '';

  for (let i = 1; i <= pageCount; i++) {
    const li = document.createElement('li');
    li.className = `page-item ${i === currentPage ? 'active' : ''}`;
    const a = document.createElement('a');
    a.className = 'page-link';
    a.href = '#';
    a.textContent = i;
    a.addEventListener('click', (e) => {
      e.preventDefault();
      currentPage = i;
      renderTable(currentHeaders, currentData);
    });
    li.appendChild(a);
    pagination.appendChild(li);
  }
}

function loadCsv() {
  Papa.parse(CSV_URL, {
    download: true,
    complete: (results) => {
      currentHeaders = results.data[0];
      currentData = results.data.slice(1).filter(r => r.length > 1);
      currentPage = 1;
      renderTable(currentHeaders, currentData);
    }
  });
}

document.getElementById('reload').addEventListener('click', loadCsv);
document.getElementById('csv').addEventListener('click', () => {
  const csv = [currentHeaders, ...currentData].map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'hasil_absen.csv';
  a.click();
});
document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  const filtered = currentData.filter(r => r.some(c => String(c).toLowerCase().includes(q)));
  currentPage = 1;
  renderTable(currentHeaders, filtered);
});

loadCsv();
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
