<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hasil Absen</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold mb-6 text-blue-600">📋 Data Hasil Absen</h1>

  <!-- Toolbar -->
  <div class="flex flex-wrap gap-2 mb-4 w-full max-w-6xl justify-between items-center">
    <button id="refreshBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
      🔄 Refresh Data
    </button>
    <p id="lastUpdate" class="text-gray-600 text-sm">⏳ Memuat data...</p>
  </div>

  <!-- Tabel -->
  <div class="w-full max-w-6xl bg-white rounded-xl shadow-lg p-4 overflow-x-auto">
    <table id="dataTable" class="table-auto border-collapse border border-gray-300 w-full text-sm text-left">
      <thead class="bg-blue-500 text-white"></thead>
      <tbody></tbody>
    </table>
  </div>

  <p class="mt-4 text-gray-500 text-sm">⏰ Data diperbarui otomatis setiap 5 menit</p>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vToe0xNuzA78YNxdhI7-JGaA1oPBuRH9JlQgzwoaE8C0U5kG4FNOajyzKyddqkKAWE0hDKX9vrq-QhB/pub?gid=1735243266&single=true&output=csv";

    function loadData() {
      document.getElementById("lastUpdate").textContent = "⏳ Memuat data...";
      Papa.parse(sheetUrl, {
        download: true,
        header: true,
        complete: function(results) {
          const data = results.data;
          const tableHead = document.querySelector("#dataTable thead");
          const tableBody = document.querySelector("#dataTable tbody");

          // Kosongkan tabel sebelum isi ulang
          tableHead.innerHTML = "";
          tableBody.innerHTML = "";

          if (data.length === 0) return;

          // Buat header tabel
          const headerRow = document.createElement("tr");
          Object.keys(data[0]).forEach(col => {
            const th = document.createElement("th");
            th.className = "border border-gray-300 px-4 py-2 font-semibold";
            th.textContent = col;
            headerRow.appendChild(th);
          });
          tableHead.appendChild(headerRow);

          // Buat baris data
          data.forEach(row => {
            const tr = document.createElement("tr");
            Object.values(row).forEach(val => {
              const td = document.createElement("td");
              td.className = "border border-gray-300 px-4 py-2";
              td.textContent = val;
              tr.appendChild(td);
            });
            tableBody.appendChild(tr);
          });

          // Update waktu terakhir refresh
          const now = new Date();
          document.getElementById("lastUpdate").textContent =
            "⏰ Terakhir diperbarui: " + now.toLocaleString("id-ID");
        }
      });
    }

    // Load pertama kali
    loadData();

    // Tombol refresh manual
    document.getElementById("refreshBtn").addEventListener("click", loadData);

    // Update otomatis setiap 5 menit (300.000 ms)
    setInterval(loadData, 300000);
  </script>
</body>
</html>
